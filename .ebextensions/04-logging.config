option_settings:
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 7

  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /health

files:
  # Ensure the Laravel log file is included in the log bundle
  "/opt/elasticbeanstalk/tasks/bundlelogs.d/laravel.conf":
    mode: "000755"
    owner: root
    group: root
    content: |
      /var/app/current/storage/logs/*.log

  # Ensure the Laravel log file is tailed (optional, for real-time log viewing)
  "/opt/elasticbeanstalk/tasks/taillogs.d/laravel.conf":
    mode: "000755"
    owner: root
    group: root
    content: |
      /var/app/current/storage/logs/laravel.log

container_commands:
  # Create the logs directory if it doesn't exist
  01-create_log_dir:
    command: |
      mkdir -p /var/app/current/storage/logs
      chmod -R 775 /var/app/current/storage/logs
      chown -R webapp:webapp /var/app/current/storage/logs

  # Create the Laravel log file if it doesn't exist
  02-touch_log_file:
    command: |
      touch /var/app/current/storage/logs/laravel.log
      chmod 664 /var/app/current/storage/logs/laravel.log
      chown webapp:webapp /var/app/current/storage/logs/laravel.log